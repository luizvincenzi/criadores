import React, { useState } from 'react';
import { 
  ChevronLeft, 
  ChevronRight, 
  Plus, 
  Video, 
  Image as ImageIcon, 
  Calendar as CalendarIcon,
  Columns,
  Search,
  MoreHorizontal,
  Clock,
  Filter,
  CheckCircle2,
  Circle,
  CalendarDays
} from 'lucide-react';

const App = () => {
  const [viewMode, setViewMode] = useState('week'); // 'week' or 'month'
  const [currentDate, setCurrentDate] = useState("Novembro 2025");
  
  // Estado para controlar quais itens foram concluídos (simulação)
  // Usamos um objeto onde a chave é o ID único do item (simulado aqui pelo index+dia)
  const [completedItems, setCompletedItems] = useState({});

  const toggleComplete = (id) => {
    setCompletedItems(prev => ({
      ...prev,
      [id]: !prev[id]
    }));
  };

  const goToToday = () => {
    // Numa implementação real, isso navegaria para a data atual.
    // Aqui apenas simulamos um feedback visual ou reset
    console.log("Indo para hoje...");
    alert("Navegando para o dia de hoje (Simulação)");
  };

  // --- MOCK DATA ---
  const weekDays = [
    { id: 1, name: 'Segunda', short: 'SEG', date: '24', isToday: false },
    { id: 2, name: 'Terça', short: 'TER', date: '25', isToday: true }, // Hoje
    { id: 3, name: 'Quarta', short: 'QUA', date: '26', isToday: false },
    { id: 4, name: 'Quinta', short: 'QUI', date: '27', items: [
      { id: 't1', type: 'reels', title: 'Bastidores Rooftop', status: 'approved', time: '14:00' },
      { id: 't2', type: 'post', title: 'Promo Drinks', status: 'draft', time: '18:30' }
    ]},
    { id: 5, name: 'Sexta', short: 'SEX', date: '28', items: [
      { id: 't3', type: 'post', title: 'Agenda DJ', status: 'scheduled', time: '12:00' }
    ]},
    { id: 6, name: 'Sábado', short: 'SÁB', date: '29', isToday: false },
    { id: 7, name: 'Domingo', short: 'DOM', date: '30', isToday: false },
  ];

  const monthDays = Array.from({ length: 35 }, (_, i) => {
    const day = i - 2; 
    if (day <= 0) return { day: 30 + day, currentMonth: false };
    if (day > 30) return { day: day - 30, currentMonth: false };
    
    let items = [];
    if (day === 27) items = [{ type: 'reels', title: 'Bastidores', color: 'green' }, { type: 'post', title: 'Promo', color: 'blue' }];
    if (day === 28) items = [{ type: 'post', title: 'Agenda DJ', color: 'blue' }, { type: 'stories', title: 'Enquete', color: 'purple' }];
    if (day === 12) items = [{ type: 'reels', title: 'Teaser', color: 'green' }];
    
    return { day, currentMonth: true, isToday: day === 25, items };
  });

  const weekDayHeaders = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];

  return (
    // BACKGROUND: Mantendo o cinza claro #f5f5f5
    <div className="flex items-center justify-center h-screen w-full bg-[#f5f5f5] relative overflow-hidden font-sans selection:bg-black/10">
      
      {/* MAIN CONTAINER: Responsivo (w-full no mobile, w-[95%] no desktop) */}
      <div className="w-full h-full sm:w-[95%] sm:h-[92%] relative z-10 flex flex-col sm:rounded-[40px] border-0 sm:border border-white/60 bg-white/40 backdrop-blur-[50px] shadow-none sm:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.08)] overflow-hidden transition-all duration-500">
        
        {/* --- HEADER --- */}
        <div className="flex-shrink-0 flex flex-col md:flex-row items-start md:items-center justify-between border-b border-white/30 p-4 md:px-8 md:h-24 gap-4 bg-white/40">
          
          {/* Left: Date & Nav */}
          <div className="flex items-center justify-between w-full md:w-auto gap-6">
             <div className="flex flex-col">
               <span className="text-[10px] md:text-xs font-bold text-gray-500/80 uppercase tracking-widest pl-1">Calendário</span>
               <div className="flex items-center gap-2 md:gap-3">
                 <h1 className="text-xl md:text-2xl font-semibold text-[#1d1d1f] tracking-tight whitespace-nowrap">{currentDate}</h1>
                 
                 {/* Navigation Arrows */}
                 <div className="flex gap-1 ml-1 md:ml-2">
                   <button className="w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center hover:bg-white/50 transition-colors text-[#1d1d1f]">
                     <ChevronLeft className="w-4 h-4 md:w-5 md:h-5 opacity-70" />
                   </button>
                   <button className="w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center hover:bg-white/50 transition-colors text-[#1d1d1f]">
                     <ChevronRight className="w-4 h-4 md:w-5 md:h-5 opacity-70" />
                   </button>
                 </div>

                 {/* BUTTON: GO TO TODAY */}
                 <button 
                    onClick={goToToday}
                    className="ml-2 px-3 py-1.5 bg-white/60 hover:bg-white border border-white/50 rounded-full text-xs font-semibold text-[#1d1d1f] transition-all shadow-sm flex items-center gap-1.5 active:scale-95"
                 >
                    <CalendarDays className="w-3.5 h-3.5 text-blue-600" />
                    <span className="hidden sm:inline">Hoje</span>
                 </button>
               </div>
             </div>

             {/* Mobile Search/Add (Only visible on small screens here) */}
             <div className="md:hidden flex gap-2">
                <button className="w-9 h-9 rounded-full bg-[#1d1d1f] text-white flex items-center justify-center shadow-md">
                   <Plus className="w-5 h-5" />
                </button>
             </div>
          </div>

          {/* Center: View Switcher (Dynamic Island style) - Position adjusted for mobile */}
          <div className="md:absolute md:left-1/2 md:-translate-x-1/2 self-center bg-black/5 p-1 rounded-full backdrop-blur-md border border-white/20 shadow-inner w-full md:w-auto flex justify-center max-w-[300px]">
            <div className="flex relative w-full md:w-auto">
              <button 
                onClick={() => setViewMode('week')}
                className={`flex-1 md:flex-none px-6 py-1.5 md:py-2 rounded-full text-xs md:text-sm font-medium flex items-center justify-center gap-2 transition-all duration-300 ${
                  viewMode === 'week' 
                    ? 'bg-white text-black shadow-lg shadow-black/5 scale-100' 
                    : 'text-gray-500 hover:text-black scale-95'
                }`}
              >
                <Columns className="w-3.5 h-3.5 md:w-4 md:h-4" />
                <span className="">Semana</span>
              </button>
              <button 
                onClick={() => setViewMode('month')}
                className={`flex-1 md:flex-none px-6 py-1.5 md:py-2 rounded-full text-xs md:text-sm font-medium flex items-center justify-center gap-2 transition-all duration-300 ${
                  viewMode === 'month' 
                    ? 'bg-white text-black shadow-lg shadow-black/5 scale-100' 
                    : 'text-gray-500 hover:text-black scale-95'
                }`}
              >
                <CalendarIcon className="w-3.5 h-3.5 md:w-4 md:h-4" />
                <span className="">Mês</span>
              </button>
            </div>
          </div>

          {/* Right: Actions (Hidden on mobile mostly) */}
          <div className="hidden md:flex items-center gap-3">
             <div className="relative group">
               <Search className="w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2" />
               <input 
                 type="text" 
                 placeholder="Buscar..." 
                 className="w-10 group-focus-within:w-48 bg-white/30 border border-white/20 rounded-full py-2 pl-10 pr-4 text-sm outline-none focus:bg-white/60 transition-all duration-300 placeholder:text-gray-500"
               />
             </div>
             <button className="w-10 h-10 rounded-full bg-[#1d1d1f] text-white flex items-center justify-center shadow-lg shadow-black/10 hover:scale-105 active:scale-95 transition-all">
               <Plus className="w-5 h-5" />
             </button>
          </div>
        </div>

        {/* --- CONTENT AREA --- */}
        <div className="flex-1 overflow-hidden relative bg-[#f9f9f9]/50">
          
          {viewMode === 'week' ? (
            /* WEEK VIEW */
            <div className="h-full overflow-x-auto overflow-y-hidden px-4 md:px-8 pb-8 pt-4 md:pt-6 flex gap-3 md:gap-4 snap-x snap-mandatory">
              {weekDays.map((day) => (
                <div key={day.id} className="snap-center flex-shrink-0 w-[85vw] md:w-[220px] flex flex-col h-full group">
                  
                  {/* Floating Date Header */}
                  <div className={`mb-3 flex items-center justify-between px-4 py-3 rounded-2xl transition-all duration-300 ${
                    day.isToday 
                      ? 'bg-blue-600 shadow-md shadow-blue-500/20 translate-y-1' 
                      : 'bg-transparent'
                  }`}>
                    <span className={`text-xs font-bold uppercase tracking-widest ${
                      day.isToday ? 'text-white/80' : 'text-gray-500'
                    }`}>
                      {day.short}
                    </span>
                    <span className={`text-xl font-light tracking-tight ${
                      day.isToday ? 'text-white font-medium' : 'text-[#1d1d1f]'
                    }`}>
                      {day.date}
                    </span>
                  </div>

                  {/* Day Column (White Background as requested) */}
                  {/* Se for 'Hoje', adicionamos uma borda azul e sombra mais forte */}
                  <div className={`
                    flex-1 rounded-[30px] p-2 flex flex-col gap-3 transition-colors relative
                    ${day.isToday 
                      ? 'bg-white border-2 border-blue-500/20 shadow-xl shadow-blue-500/5' 
                      : 'bg-white border border-white/50 shadow-sm hover:shadow-md'}
                  `}>
                    
                    {/* Add Button (Ghost) - Always visible on today or hover on others */}
                    <button className={`
                      absolute inset-x-4 top-2 h-10 border border-dashed rounded-xl flex items-center justify-center transition-all z-10
                      ${day.isToday 
                        ? 'border-blue-200 text-blue-400 hover:bg-blue-50' 
                        : 'border-gray-200 text-gray-400 opacity-0 group-hover:opacity-100 hover:bg-gray-50'}
                    `}>
                      <Plus className="w-4 h-4" />
                    </button>
                    
                    <div className="mt-12 flex flex-col gap-3 overflow-y-auto pr-1 custom-scrollbar h-full">
                      {day.items?.map((item) => {
                         const isCompleted = completedItems[`${day.id}-${item.id}`];

                         return (
                          <div key={item.id} className="relative group/card">
                            <div className={`
                              p-3 md:p-4 rounded-[24px] border transition-all duration-300
                              ${isCompleted 
                                ? 'bg-gray-50 border-gray-100 opacity-60' 
                                : 'bg-white border-gray-100 shadow-sm hover:shadow-lg hover:-translate-y-1'}
                            `}>
                              
                              {/* Header: Tag + Check Button */}
                              <div className="flex justify-between items-start mb-3">
                                <span className={`px-2 md:px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide flex items-center gap-1.5 ${
                                  item.type === 'reels' ? 'bg-green-500/10 text-green-700' : 'bg-blue-500/10 text-blue-700'
                                }`}>
                                  {item.type === 'reels' ? <Video className="w-3 h-3" /> : <ImageIcon className="w-3 h-3" />}
                                  {item.type}
                                </span>
                                
                                {/* CHECK BUTTON */}
                                <button 
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    toggleComplete(`${day.id}-${item.id}`);
                                  }}
                                  className="text-gray-300 hover:text-green-500 transition-colors focus:outline-none"
                                >
                                  {isCompleted ? (
                                    <CheckCircle2 className="w-5 h-5 text-green-500 fill-green-100" />
                                  ) : (
                                    <Circle className="w-5 h-5 hover:stroke-2" />
                                  )}
                                </button>
                              </div>

                              <h4 className={`text-sm md:text-[15px] font-medium text-[#1d1d1f] mb-2 leading-snug transition-all ${
                                isCompleted ? 'line-through text-gray-400' : ''
                              }`}>
                                {item.title}
                              </h4>
                              
                              <div className="flex items-center gap-2 text-xs text-gray-500 font-medium pt-2 border-t border-gray-100">
                                <Clock className="w-3 h-3" />
                                {item.time}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                      
                      {/* Empty State visual for Today */}
                      {day.isToday && !day.items && (
                        <div className="flex flex-col items-center justify-center py-8 text-center opacity-40">
                          <span className="text-sm text-gray-400 font-medium">Nada por enquanto</span>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            /* MONTH VIEW */
            <div className="h-full flex flex-col p-4 md:p-6 overflow-y-auto">
              {/* Grid Header */}
              <div className="grid grid-cols-7 mb-4">
                {weekDayHeaders.map(day => (
                  <div key={day} className="text-center text-[10px] md:text-[11px] font-bold text-gray-400 uppercase tracking-widest opacity-60">
                    {day}
                  </div>
                ))}
              </div>

              {/* Grid */}
              <div className="flex-1 grid grid-cols-7 auto-rows-fr gap-1 md:gap-3 min-h-[400px]">
                {monthDays.map((date, index) => (
                  <div 
                    key={index} 
                    className={`
                      relative rounded-[16px] md:rounded-[24px] p-1 md:p-3 border transition-all duration-200 group flex flex-col
                      ${!date.currentMonth ? 'bg-transparent border-transparent opacity-30' : 
                        date.isToday ? 'bg-white border-blue-200 ring-1 ring-blue-100 shadow-md' : 'bg-white/40 border-white/40 hover:bg-white hover:shadow-sm'}
                    `}
                  >
                    <div className="flex justify-center md:justify-start items-start mb-1">
                      <span className={`
                        w-6 h-6 md:w-8 md:h-8 flex items-center justify-center rounded-full text-xs md:text-sm font-medium transition-all
                        ${date.isToday ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'text-[#1d1d1f]'}
                      `}>
                        {date.day}
                      </span>
                    </div>

                    <div className="flex flex-col gap-1 mt-1 md:mt-2 overflow-hidden">
                      {date.items?.map((item, idx) => (
                        <div 
                          key={idx}
                          className={`
                            hidden md:flex px-2 py-1 rounded-full text-[9px] font-bold truncate items-center gap-1.5
                            ${item.color === 'green' ? 'bg-green-100 text-green-800' : 
                              item.color === 'purple' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}
                          `}
                        >
                          <div className={`w-1.5 h-1.5 rounded-full flex-shrink-0 ${
                             item.color === 'green' ? 'bg-green-500' : 
                             item.color === 'purple' ? 'bg-purple-500' : 'bg-blue-500'}
                          `} />
                          <span className="truncate">{item.title}</span>
                        </div>
                      ))}
                      {/* Mobile Dots for events */}
                      <div className="md:hidden flex justify-center gap-0.5 mt-1">
                        {date.items?.map((item, idx) => (
                          <div key={idx} className={`w-1 h-1 rounded-full ${
                            item.color === 'green' ? 'bg-green-500' : 
                            item.color === 'purple' ? 'bg-purple-500' : 'bg-blue-500'
                          }`} />
                        ))}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

        </div>

        {/* --- BOTTOM BAR --- */}
        <div className="h-14 border-t border-white/20 flex items-center justify-between px-6 md:px-8 bg-white/60 backdrop-blur-md">
           <div className="flex items-center gap-4 text-xs font-medium text-gray-500">
             <span className="flex items-center gap-1.5">
               <span className="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)] animate-pulse" />
               <span className="hidden sm:inline">Sincronizado</span>
             </span>
             <span className="w-px h-3 bg-gray-400/30 hidden sm:block" />
             <span className="hidden sm:block">3 Rascunhos</span>
           </div>
           
           <div className="flex items-center gap-2">
              <button className="flex items-center gap-2 px-3 py-1 rounded-full hover:bg-white/50 text-xs font-medium text-gray-600 transition-colors">
                 <Filter className="w-3 h-3" />
                 <span className="hidden sm:inline">Filtrar</span>
              </button>
           </div>
        </div>

      </div>
    </div>
  );
};

export default App;