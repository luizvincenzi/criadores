<!DOCTYPE html>
<html>
<head>
    <title>Criar Campanha Teste Simples</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Criar Campanha de Teste</h1>
    
    <button onclick="createTestCampaign()">Criar Campanha "Auto Posto Bela Su√≠√ßa"</button>
    
    <div id="result">Clique no bot√£o para criar a campanha...</div>

    <script>
        async function createTestCampaign() {
            const result = document.getElementById('result');
            result.innerHTML = 'üîÑ Criando campanha de teste...';

            try {
                // 1. Primeiro buscar ou criar o business
                result.innerHTML = 'üîÑ 1/3 - Verificando business...';
                
                const businessResponse = await fetch('/api/supabase/businesses');
                const businessData = await businessResponse.json();
                
                let autoPostoBusiness = null;
                
                if (businessData.success) {
                    autoPostoBusiness = businessData.data.find(b => 
                        b.name && b.name.toLowerCase().includes('auto posto')
                    );
                }

                if (!autoPostoBusiness) {
                    result.innerHTML = 'üîÑ 1/3 - Criando business "Auto Posto Bela Su√≠√ßa"...';
                    
                    const createBusinessResponse = await fetch('/api/supabase/businesses', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: 'Auto Posto Bela Su√≠√ßa',
                            contact_info: {
                                phone: '43 99999-9999',
                                whatsapp: '43 99999-9999',
                                email: 'contato@autopostobela.com.br'
                            },
                            address: {
                                city: 'Londrina',
                                state: 'PR',
                                country: 'Brasil'
                            },
                            category_id: 1,
                            current_plan_id: 1,
                            status: 'Ativo'
                        })
                    });

                    const createBusinessResult = await createBusinessResponse.json();
                    
                    if (!createBusinessResult.success) {
                        result.innerHTML = `‚ùå Erro ao criar business: ${createBusinessResult.error}`;
                        return;
                    }

                    autoPostoBusiness = createBusinessResult.data;
                }

                result.innerHTML = `üîÑ 2/3 - Business encontrado: ${autoPostoBusiness.name}`;

                // 2. Criar a campanha
                result.innerHTML = 'üîÑ 2/3 - Criando campanha...';
                
                const campaignData = {
                    business_id: autoPostoBusiness.id,
                    title: 'Campanha Julho 2025 - Auto Posto Bela Su√≠√ßa',
                    description: 'Campanha de marketing digital para promover os servi√ßos do Auto Posto Bela Su√≠√ßa',
                    month: '2025-07',
                    month_year_id: 202507, // üéØ ID √∫nico do m√™s/ano
                    budget: 5000,
                    status: 'Reuni√£o de briefing',
                    objectives: {
                        primary: 'Aumentar awareness da marca',
                        secondary: ['Atrair novos clientes', 'Promover servi√ßos'],
                        kpis: { reach: 15000, engagement: 750, conversions: 100 }
                    },
                    deliverables: {
                        posts: 3,
                        stories: 5,
                        reels: 2,
                        events: 0,
                        requirements: ['Mencionar localiza√ß√£o', 'Destacar qualidade dos combust√≠veis'],
                        creators_count: 4
                    },
                    briefing_details: {
                        formatos: ['Reels', 'Stories', 'Posts'],
                        perfil_criador: 'Criadores locais de Londrina e regi√£o, com foco em lifestyle e automotivo',
                        comunicacao_secundaria: 'Destacar a qualidade dos combust√≠veis e conveni√™ncia da localiza√ß√£o',
                        datas_gravacao: {
                            data_inicio: '2025-07-01',
                            data_fim: '2025-07-15',
                            horarios_preferenciais: ['Manh√£', 'Tarde'],
                            observacoes: 'Evitar hor√°rios de pico para n√£o atrapalhar o movimento'
                        },
                        roteiro_video: {
                            o_que_falar: 'Falar sobre a qualidade dos combust√≠veis, atendimento diferenciado e localiza√ß√£o estrat√©gica do Auto Posto Bela Su√≠√ßa',
                            historia: 'Contar sobre a tradi√ß√£o familiar do posto e o compromisso com a qualidade',
                            promocao_cta: 'Venha conhecer o Auto Posto Bela Su√≠√ßa e comprove a diferen√ßa na qualidade!'
                        }
                    }
                };

                const campaignResponse = await fetch('/api/supabase/campaigns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(campaignData)
                });

                const campaignResult = await campaignResponse.json();

                if (!campaignResult.success) {
                    result.innerHTML = `‚ùå Erro ao criar campanha: ${campaignResult.error}`;
                    return;
                }

                result.innerHTML = 'üîÑ 3/3 - Testando busca da campanha...';

                // 3. Testar busca da campanha
                const searchResponse = await fetch('/api/supabase/campaigns?businessName=Auto%20Posto%20Bela%20Su%C3%AD%C3%A7a&month=2025-07');
                const searchResult = await searchResponse.json();

                if (searchResult.success && searchResult.data.length > 0) {
                    const campaign = searchResult.data[0];
                    
                    result.innerHTML = `
                        <h3>‚úÖ Campanha criada e encontrada com sucesso!</h3>
                        
                        <h4>üìã Dados da Campanha:</h4>
                        <p><strong>ID:</strong> ${campaign.id}</p>
                        <p><strong>T√≠tulo:</strong> ${campaign.nome || campaign.title}</p>
                        <p><strong>Business:</strong> ${campaign.businessName}</p>
                        <p><strong>M√™s:</strong> ${campaign.mes || campaign.month}</p>
                        <p><strong>Or√ßamento:</strong> R$ ${campaign.orcamento || campaign.budget}</p>
                        <p><strong>Descri√ß√£o:</strong> ${campaign.descricao || campaign.description}</p>
                        <p><strong>Objetivos:</strong> ${campaign.objetivos?.primary || 'N/A'}</p>
                        <p><strong>Briefing Details:</strong> ${campaign.briefing_details ? '‚úÖ Sim' : '‚ùå N√£o'}</p>
                        
                        <h4>üß™ Pr√≥ximos Testes:</h4>
                        <ol>
                            <li>Abrir a <a href="/campaigns" target="_blank">p√°gina de campanhas</a></li>
                            <li>Encontrar "Auto Posto Bela Su√≠√ßa"</li>
                            <li>Clicar em "Ver Detalhes"</li>
                            <li>Verificar se os dados aparecem corretamente</li>
                            <li>Testar o bot√£o "Editar"</li>
                            <li>Testar o bot√£o "Salvar"</li>
                        </ol>
                        
                        <button onclick="testModal()">Testar Modal de Detalhes</button>
                        
                        <details>
                            <summary>Ver dados completos da campanha</summary>
                            <pre>${JSON.stringify(campaign, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    result.innerHTML = `
                        <h3>‚ö†Ô∏è Campanha criada mas n√£o encontrada na busca</h3>
                        <p>A campanha foi criada com sucesso, mas n√£o foi encontrada na busca.</p>
                        <p>Isso pode indicar um problema na API de busca.</p>
                        
                        <h4>Dados da cria√ß√£o:</h4>
                        <pre>${JSON.stringify(campaignResult, null, 2)}</pre>
                        
                        <h4>Resultado da busca:</h4>
                        <pre>${JSON.stringify(searchResult, null, 2)}</pre>
                    `;
                }

            } catch (error) {
                console.error('Erro:', error);
                result.innerHTML = `‚ùå Erro: ${error.message}`;
            }
        }

        async function testModal() {
            const result = document.getElementById('result');
            result.innerHTML += '<br><br>üîÑ Testando modal de detalhes...';
            
            // Simular abertura do modal (isso seria feito na interface)
            result.innerHTML += '<br>üìù Para testar o modal:';
            result.innerHTML += '<br>1. Abra a <a href="/campaigns" target="_blank">p√°gina de campanhas</a>';
            result.innerHTML += '<br>2. Encontre "Auto Posto Bela Su√≠√ßa" na lista';
            result.innerHTML += '<br>3. Clique em "Ver Detalhes"';
            result.innerHTML += '<br>4. Verifique se os campos est√£o preenchidos';
            result.innerHTML += '<br>5. Clique em "Editar" e teste a edi√ß√£o';
            result.innerHTML += '<br>6. Clique em "Salvar" e verifique se salva';
        }
    </script>
</body>
</html>
